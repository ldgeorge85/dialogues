# Philosophical Multi-Agent Debate System - Source of Truth

This document serves as the source of truth for the Philosophical Multi-Agent Debate System project, tracking all files, their purposes, and project structure.

## Project Overview

A multi-agent AI system that simulates philosophical debates between different philosophical personas. The system takes user prompts about philosophical topics, analyzes them through multiple philosophical lenses, facilitates debate between the philosophical agents, and provides a synthesized summary of the different viewpoints. 

### Key Features (Current)
- **Dynamic Agent Loading:** All debate and judge agents are defined in markdown files and loaded at runtime from `agent_definitions/` and `judge_definitions/`.
- **Debate Flow:** Canonical debate protocol is Opening Statement → Rebuttal → Summarization → Judging.
- **Summarizer Agent:** Summaries are generated by a single, non-evaluative summarizer agent defined in `summarizer_definitions/Summarizer.md`. The summarizer only restates the points and arguments for each agent, with no evaluative or opinionated language.
- **Judging:** Judge agents (from `judge_definitions/`) vote using only the agent summaries, not the full transcript. Each judge uses a distinct, editable prompt and quorum logic is enforced (must be odd number of judges).
- **Parallelization:** All LLM calls for each phase (openings, rebuttals, summarization) are parallelized according to the `PARALLEL_AGENTS` environment variable. Phases remain sequential.
- **Transcript & Logging:** Full debate transcript, agent summaries, judge votes, and rationales are logged for transparency.
- **Extensible:** New agents and judges can be added by creating new markdown files. Summarizer and judge prompts are editable for custom debate/judging styles.
- **No legacy/static agents:** All agent lists and judging logic are dynamic and file-driven.

## Technology Stack

- **Language**: Python 3.9+
- **Framework**: Autogen for multi-agent orchestration
- **LLM Backend**: OpenAI API (configurable)
- **UI**: Initially CLI, potentially web-based in the future

## Project Structure

```
dialogues/
├── memory/                    # Persistent memory storage
│   ├── agents/                # Agent-specific memories
│   ├── debates/               # Complete debate records
│   └── indexes/               # Memory indexing system
├── agent_definitions/         # Individual agent definition files (all agents are loaded dynamically from here)
│   └── *.md                   # One file per philosophical agent
├── judge_definitions/         # Judge agent definition files (all judges loaded dynamically)
│   ├── JudgeLogic.md
│   ├── JudgeEthics.md
│   ├── JudgeOriginality.md
│   ├── JudgePracticality.md
│   └── JudgeSystemicRisk.md
├── summarizer_definitions/    # Summarizer agent definition (single file, non-evaluative)
│   └── Summarizer.md
├── docs/                      # Documentation
│   ├── source_of_truth.md     # This document - project overview and file tracking
│   ├── implementation_plan.md # Detailed implementation plan
│   ├── agent_specifications.md # Specifications for different philosophical agents
│   ├── persistent_memory.md   # Documentation for the memory system
│   ├── dynamic_agent_system.md # Documentation for dynamic agent loading
│   ├── project_structure.md   # Detailed project structure documentation
│   ├── agent_architecture.md  # Documentation for agent architecture
│   ├── task_breakdown.md      # Task breakdown for project phases
│   └── debate_flow.md         # Documentation for debate flow
├── src/                       # Source code
│   ├── __init__.py            # Package initializer
│   ├── agents/                # Agent implementations
│   │   ├── __init__.py        # Package initializer
│   │   ├── base.py            # Base agent class
│   │   ├── orchestrator_dynamic.py # Canonical orchestrator (uses dynamic agent loading)
│   │   ├── dynamic_agent.py   # Dynamic agent class for file-defined agents
│   │   ├── agent_loader.py    # Utilities to load agents from definition files
│   │   ├── judge_agent.py     # Judge agent implementation (uses only summaries for voting)
│   │   ├── judge_loader.py    # Loads judge agents from judge_definitions/
│   │   ├── summarizer_loader.py # Loads summarizer agent from summarizer_definitions/
│   │   └── quorum.py          # Quorum logic implementation
│   ├── memory/                # Memory system
│   │   ├── __init__.py        # Package initializer
│   │   └── memory_manager.py  # Memory manager for storing/retrieving agent memories
│   ├── metrics/               # Metrics and analysis for debates
│   │   ├── __init__.py        # Package initializer
│   │   ├── debate_metrics.py  # Calculation of debate quality metrics
│   │   ├── token_usage.py     # Tracks and reports token usage per agent, phase, and debate
│   │   └── visualizers.py     # Visualization tools for metrics
│   ├── utils/                 # Utility functions
│   │   ├── memory_query.py    # Tools for querying the memory system
│   │   └── convert_agent_definitions.py # Utility to convert system messages to agent definition files
│   ├── cli/                   # Command-line interfaces
│   │   └── memory_explorer.py # Interactive CLI for exploring memory
│   ├── debate/                # Debate management
│   │   ├── __init__.py        # Package initializer
│   │   ├── manager.py         # Debate flow management
│   │   └── analyzer.py        # Prompt analysis functionality
│   ├── config/                # System Configuration
│   │   └── __init__.py        # Package initializer
│   │   ### Per-Phase Parallelism (2025-06)
│   │   - You can now set the maximum number of parallel prompts for each debate phase via environment variables:
│   │     - `PARALLEL_AGENTS_OPENING`, `PARALLEL_AGENTS_REBUTTAL`, `PARALLEL_AGENTS_SUMMARY`, `PARALLEL_AGENTS_JUDGING`
│   │   - If a phase-specific variable is unset, the system uses the value of `PARALLEL_AGENTS` as fallback.
│   │   - This is essential for LLM providers with limited context/KV cache: use a lower value for summary/judging phases to avoid overflow, while keeping higher parallelism for opening/rebuttal.
│   │   - See `src/agents/orchestrator_dynamic.py` for implementation details.
│   ├── ui/                    # User interface
│   │   └── __init__.py        # Package initializer
│   ├── main.py                # Original entry point
│   ├── main_dynamic.py        # Entry point with dynamic agent loading
│   └── main_with_memory.py    # Entry point with memory integration
├── requirements.txt           # Project dependencies
├── setup.py                   # Package installation
├── Dockerfile                 # Docker image for containerized environment
├── docker-compose.yml         # Compose file for running the system as a service
├── run_memory_test.sh         # Script to test memory system integration
├── explore_memory.sh          # Script to run memory explorer CLI
├── analyze_debates.sh         # Script to run debate metrics calculation and visualization
├── .env.example               # Example environment variables including PARALLEL_AGENTS
└── README.md                  # Project readme
```

## Documentation

- `docs/agent_specifications.md`: Documents the concept that each agent embodies a distinct philosophical archetype, along with their core responsibilities: analyzing user prompts, critiquing other agents, and contributing to a debate summary.
- `docs/implementation_plan.md`: References the philosophical archetype agent structure and describes how this is implemented in code, ensuring alignment with the specifications.
- `docs/persistent_memory.md`: Comprehensive documentation of the memory system architecture, features, and usage.
- `docs/dynamic_agent_system.md`: Documentation for the dynamic agent loading system from individual agent definition files. 
- **Dynamic agent loading**: Agents are loaded at runtime from the `agent_definitions/` directory using `agent_loader.py`.
- **Judge agent loading**: Judge agents are loaded at runtime from the `judge_definitions/` directory using `judge_loader.py`. Each judge has a distinct prompt and only receives agent summaries for voting.
- **Summarizer agent**: The summarizer agent is defined in `summarizer_definitions/Summarizer.md` and is strictly non-evaluative. It generates factual, non-opinionated summaries for each agent, which are then used by the judges.
- **Debate protocol**: The canonical orchestrator (`orchestrator_dynamic.py`) runs debates in four phases: Opening Statement, Rebuttal, Summarization, and Judging. All LLM calls for each phase are parallelized according to the `PARALLEL_AGENTS` environment variable.
- **Token usage tracking**: The `token_usage.py` module tracks and reports token usage per agent, per phase, and per debate. Usage logs are stored in `memory/token_usage/` as JSON files keyed by debate ID. The tracker can be used to log, load, and summarize token usage across debates.
- **Agent methods**: Dynamic agents support `opening_statement` and `rebuttal` methods for new debate phases, falling back to `analyze_prompt` and `critique` for legacy compatibility. Agent definitions can provide explicit prompts for these phases.
- `docs/project_structure.md`: Detailed documentation of the project structure with directory tree and file descriptions.
- `README.md`: The Project Overview section states the multi-agent debate concept, agent archetypes, responsibilities, and summary output.
- `docs/task_breakdown.md`: Updatable, structured breakdown of all project tasks, designed for both human and AI coding assistants.

## File Status

| File | Status | Description |
|------|--------|-------------|
| docs/source_of_truth.md | Updated | This document - now includes memory system, metrics, dynamic summarization, and judge agent handling |
| docs/implementation_plan.md | Updated | Detailed implementation plan, including philosophical archetype agent structure |
| docs/agent_specifications.md | Updated | Specifications for philosophical agents, including archetype concept and responsibilities |
| docs/persistent_memory.md | Created | Documentation for the memory system |
| docs/dynamic_agent_system.md | Created | Documentation for dynamic agent loading |
| docs/project_structure.md | Updated | Detailed project structure documentation |
| docs/task_breakdown.md | Created | Updatable, structured breakdown of all project tasks |
| src/__init__.py | Created | Package initializer for src |
| src/agents/__init__.py | Created | Package initializer for agents |
| src/agents/base.py | Created | Base class for philosophical agents |
| src/agents/orchestrator_dynamic.py | Created | Canonical orchestrator (uses dynamic agent loading) |
| src/agents/orchestrator.py | Refactored | Legacy orchestrator (now wraps dynamic loading, see orchestrator_dynamic.py) |
| src/agents/dynamic_agent.py | Created | Dynamic agent class for file-defined agents |
| src/agents/agent_loader.py | Created | Utilities to load agents from definition files |
| src/agents/synthesis.py | Created | Synthesis agent implementation |
| src/memory/__init__.py | Created | Package initializer for memory module |
| src/memory/memory_manager.py | Updated | Memory manager for storing/retrieving memories - fixed metadata handling |
| src/metrics/__init__.py | Created | Package initializer for metrics module |
| src/metrics/debate_metrics.py | Updated | Calculation of debate quality metrics - fixed for compatibility with memory system |
| src/metrics/visualizers.py | Created | Visualization tools for metrics |
| src/utils/memory_query.py | Updated | Tools for querying the memory system - fixed metadata handling |
| src/utils/convert_agent_definitions.py | Created | Utility to convert system messages to agent definition files |
| src/cli/memory_explorer.py | Updated | Interactive CLI for exploring memory - fixed display of debate info |
| src/debate/__init__.py | Created | Package initializer for debate |
| src/debate/manager.py | Created | Debate flow management |
| src/debate/analyzer.py | Created | Prompt analysis functionality |
| src/config/__init__.py | Created | Package initializer for config |
| src/ui/__init__.py | Created | Package initializer for ui |
| src/main.py | Created | Original entry point |
| src/main_dynamic.py | Created | Entry point with dynamic agent loading |
| src/main_with_memory.py | Created | Entry point with memory integration |
| requirements.txt | Updated | Project dependencies including python-dotenv |
| setup.py | Created | Package installation and setup |
| Dockerfile | Created | Docker image for containerized testing and development |
| docker-compose.yml | Updated | Compose file with memory directories and PARALLEL_AGENTS |
| run_memory_test.sh | Created | Script to test memory system integration |
| explore_memory.sh | Created | Script to run memory explorer CLI |
| analyze_debates.sh | Created | Script to run debate metrics calculation and visualization |
| .env.example | Updated | Example environment variables including PARALLEL_AGENTS |

## Review Log

- **June 9, 2025:** Reviewed all agent, summarizer, and judge definition files in `agent_definitions/`, `summarizer_definitions/`, and `judge_definitions/`. Confirmed they are well-structured, detailed, and meet project requirements for distinct personas and roles, suitable for the target LLM (Gemma3 27B IT). No content changes made to definitions as they are currently of high quality and align with project goals.

*Note: This document will be updated as files are created, modified, or deleted.*
